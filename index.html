<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TED Pro - European Tender Search Platform</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #5B6CF2;
            --primary-dark: #4854D9;
            --primary-light: #7B8BFF;
            --success: #10B981;
            --warning: #F59E0B;
            --danger: #EF4444;
            --gray-50: #F9FAFB;
            --gray-100: #F3F4F6;
            --gray-200: #E5E7EB;
            --gray-300: #D1D5DB;
            --gray-400: #9CA3AF;
            --gray-500: #6B7280;
            --gray-600: #4B5563;
            --gray-700: #374151;
            --gray-800: #1F2937;
            --gray-900: #111827;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #FAFAFC;
            color: var(--gray-900);
            line-height: 1.6;
        }

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 320px;
            background: white;
            border-right: 1px solid var(--gray-200);
            padding: 2rem;
            overflow-y: auto;
            position: sticky;
            top: 0;
            height: 100vh;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .tagline {
            font-size: 0.875rem;
            color: var(--gray-500);
            margin-bottom: 2rem;
        }

        /* Language Switcher - NEW */
        .language-switcher {
            display: flex;
            gap: 0.5rem;
            padding: 1rem;
            background: var(--gray-50);
            border-radius: 12px;
            margin-bottom: 1.5rem;
        }

        .language-btn {
            flex: 1;
            padding: 0.625rem 1rem;
            border: 2px solid var(--gray-200);
            background: white;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .language-btn:hover {
            border-color: var(--primary-light);
            transform: translateY(-1px);
        }

        .language-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Lot Badge - NEW */
        .lot-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.375rem 0.75rem;
            background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%);
            color: white;
            border-radius: 8px;
            font-size: 0.8125rem;
            font-weight: 700;
            margin-left: 0.75rem;
            box-shadow: 0 2px 4px rgba(245, 158, 11, 0.2);
        }

        .lot-badge:hover {
            transform: scale(1.05);
            transition: transform 0.2s;
        }

        /* Lot Details Section - NEW */
        .lot-details {
            margin-top: 1rem;
            padding: 1.25rem;
            background: var(--gray-50);
            border-left: 4px solid var(--warning);
            border-radius: 10px;
        }

        .lot-details-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 700;
            font-size: 0.9375rem;
            color: var(--gray-800);
            margin-bottom: 1rem;
            cursor: pointer;
            user-select: none;
        }

        .lot-details-header:hover {
            color: var(--primary);
        }

        .lot-details-toggle {
            font-size: 0.75rem;
            color: var(--gray-500);
        }

        .lot-items {
            display: grid;
            gap: 0.75rem;
        }

        .lot-item {
            background: white;
            padding: 0.875rem 1rem;
            border-radius: 8px;
            border: 1px solid var(--gray-200);
            transition: all 0.2s;
        }

        .lot-item:hover {
            border-color: var(--primary-light);
            box-shadow: var(--shadow-sm);
        }

        .lot-item-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
            font-size: 0.875rem;
            color: var(--gray-800);
            margin-bottom: 0.375rem;
        }

        .lot-item-id {
            background: var(--warning);
            color: white;
            padding: 0.125rem 0.5rem;
            border-radius: 6px;
            font-size: 0.7rem;
            font-weight: 700;
        }

        .lot-item-title {
            flex: 1;
        }

        .lot-item-description {
            font-size: 0.8125rem;
            color: var(--gray-600);
            line-height: 1.5;
            margin-top: 0.375rem;
        }

        /* Value Display - NEW */
        .tender-value {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            background: var(--success);
            background: linear-gradient(135deg, #10B981 0%, #059669 100%);
            color: white;
            border-radius: 10px;
            margin-top: 1rem;
            font-weight: 600;
        }

        .tender-value-label {
            font-size: 0.75rem;
            opacity: 0.9;
        }

        .tender-value-amount {
            font-size: 1.25rem;
            font-weight: 700;
        }

        /* Profile Section */
        .profile-section {
            background: var(--gray-50);
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            border: 1px solid var(--gray-200);
        }

        .profile-header {
            font-weight: 600;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .profile-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 6px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .profile-badge.inactive {
            background: var(--gray-300);
            color: var(--gray-700);
        }

        .profile-badge.active {
            background: var(--success);
            color: white;
        }

        .profile-text {
            font-size: 0.8rem;
            color: var(--gray-600);
            margin-bottom: 0.75rem;
            line-height: 1.5;
        }

        .profile-summary {
            background: white;
            padding: 0.75rem;
            border-radius: 8px;
            margin-bottom: 0.75rem;
            font-size: 0.8rem;
        }

        .profile-summary-item {
            display: flex;
            justify-content: space-between;
            padding: 0.25rem 0;
        }

        .profile-summary-label {
            color: var(--gray-600);
        }

        .profile-summary-value {
            font-weight: 600;
            color: var(--gray-900);
        }

        .profile-btn {
            width: 100%;
            padding: 0.625rem;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .profile-btn:hover {
            background: var(--primary-dark);
        }

        /* Filters */
        .filters-section {
            margin-bottom: 2rem;
        }

        .filter-group {
            margin-bottom: 1.5rem;
        }

        .filter-label {
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--gray-700);
        }

        .search-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid var(--gray-300);
            border-radius: 8px;
            font-size: 0.875rem;
            transition: all 0.2s;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(91, 108, 242, 0.1);
        }

        .filter-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .filter-chip {
            padding: 0.5rem 0.875rem;
            border: 1px solid var(--gray-300);
            background: white;
            border-radius: 20px;
            font-size: 0.8125rem;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }

        .filter-chip:hover {
            border-color: var(--primary-light);
            background: var(--gray-50);
        }

        .filter-chip.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 2rem 3rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            margin-bottom: 2rem;
        }

        .header-title {
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
        }

        .header-subtitle {
            color: var(--gray-500);
            font-size: 1rem;
        }

        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid var(--gray-200);
        }

        .stat-label {
            font-size: 0.875rem;
            color: var(--gray-600);
            margin-bottom: 0.5rem;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
        }

        /* Tender Cards */
        .tenders-list {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .tender-card {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            border: 1px solid var(--gray-200);
            transition: all 0.3s;
            cursor: pointer;
        }

        .tender-card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
            border-color: var(--primary-light);
        }

        .tender-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .tender-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 0.5rem;
            line-height: 1.4;
        }

        .tender-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1rem;
            font-size: 0.875rem;
            color: var(--gray-600);
        }

        .tender-meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .tender-description {
            color: var(--gray-700);
            line-height: 1.6;
            margin-bottom: 1rem;
            font-size: 0.9375rem;
            display: -webkit-box;
            -webkit-line-clamp: 5;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .tender-description.expanded {
            display: block;
            -webkit-line-clamp: unset;
        }

        .read-more {
            color: var(--primary);
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            margin-bottom: 1rem;
        }

        .read-more:hover {
            color: var(--primary-dark);
        }

        .read-more-tip {
            background: var(--gray-50);
            border-left: 3px solid var(--primary);
            padding: 0.75rem 1rem;
            margin: 1rem 0;
            font-size: 0.875rem;
            color: var(--gray-600);
            border-radius: 6px;
        }

        .tender-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .tender-tag {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .tender-tag.urgency {
            background: var(--danger);
            color: white;
        }

        .tender-tag.deadline {
            background: var(--warning);
            color: white;
        }

        .tender-tag.framework {
            background: var(--primary);
            color: white;
        }

        .tender-tag.sme {
            background: var(--success);
            color: white;
        }

        .tender-tag.multi-lot {
            background: var(--gray-700);
            color: white;
        }

        .tender-actions {
            display: flex;
            gap: 0.75rem;
        }

        .tender-btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .tender-btn.primary {
            background: var(--primary);
            color: white;
        }

        .tender-btn.primary:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
        }

        .tender-btn.secondary {
            background: white;
            color: var(--primary);
            border: 1px solid var(--primary);
        }

        .tender-btn.secondary:hover {
            background: var(--primary);
            color: white;
        }

        /* Loading & Error States */
        .loading, .error {
            text-align: center;
            padding: 4rem 2rem;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--gray-200);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .error-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .error-message {
            color: var(--gray-600);
        }

        /* No Results */
        .no-results {
            text-align: center;
            padding: 4rem 2rem;
        }

        .no-results-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .no-results-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .no-results-text {
            color: var(--gray-600);
        }

        /* eForms Structured Notice Display */
        .view-toggle {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .view-toggle-btn {
            padding: 0.5rem 1rem;
            border: 1px solid var(--gray-300);
            background: white;
            border-radius: 8px;
            font-size: 0.8125rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .view-toggle-btn:hover {
            border-color: var(--primary-light);
        }

        .view-toggle-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .eforms-notice {
            margin-top: 1.5rem;
            padding: 1.5rem;
            background: white;
            border-radius: 12px;
            border: 1px solid var(--gray-200);
        }

        .eforms-header {
            border-bottom: 2px solid var(--gray-200);
            padding-bottom: 1rem;
            margin-bottom: 1.5rem;
        }

        .eforms-pub-number {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 0.5rem;
        }

        .eforms-metadata {
            font-size: 0.9375rem;
            color: var(--gray-700);
            margin-bottom: 0.25rem;
        }

        .eforms-dates {
            font-size: 0.875rem;
            color: var(--gray-600);
        }

        .eforms-section {
            margin-bottom: 2rem;
            padding: 1.25rem;
            background: var(--gray-50);
            border-radius: 10px;
        }

        .eforms-section-title {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .section-number {
            color: var(--primary);
            font-weight: 800;
        }

        .eforms-subsection {
            margin-left: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .eforms-subsection h4 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: 0.75rem;
        }

        .eforms-field {
            margin-bottom: 0.75rem;
            padding: 0.625rem;
            background: white;
            border-radius: 6px;
        }

        .eforms-field-label {
            font-size: 0.8125rem;
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: 0.25rem;
        }

        .eforms-field-value {
            font-size: 0.9375rem;
            color: var(--gray-600);
            line-height: 1.6;
            word-wrap: break-word;
        }

        .eforms-field-value a {
            color: var(--primary);
            text-decoration: none;
        }

        .eforms-field-value a:hover {
            text-decoration: underline;
        }

        .eforms-lot {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border-left: 4px solid var(--warning);
        }

        .eforms-lot h5 {
            font-size: 0.9375rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .eforms-lot h5::before {
            content: 'üì¶';
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar {
                display: none;
            }

            .main-content {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        function App() {
            const [tenders, setTenders] = useState([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            const [language, setLanguage] = useState('eng'); // Language state
            const [searchQuery, setSearchQuery] = useState('');
            const [selectedCategory, setSelectedCategory] = useState('all');
            const [selectedUrgency, setSelectedUrgency] = useState('all');
            const [showFrameworkOnly, setShowFrameworkOnly] = useState(false);
            const [showMultiLotOnly, setShowMultiLotOnly] = useState(false);

            useEffect(() => {
                fetch('tenders_enhanced.json')
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Failed to load tenders data');
                        }
                        return response.json();
                    })
                    .then(data => {
                        // Extract tenders array and map fields for UI compatibility
                        const tendersArray = data.tenders.map(tender => ({
                            ...tender,
                            lot_count: tender.strategic?.total_lots || 1,
                            title: tender.title,
                            description: tender.description,
                            buyer_name: tender.buyer?.name,
                            buyer_city: tender.buyer?.city,
                            buyer_country: tender.buyer?.country,
                            publication_date: tender.dates?.publication_date,
                            days_until_deadline: tender.dates?.days_until_deadline,
                            estimated_value: tender.financial?.value_original,
                            estimated_value_currency: tender.financial?.currency,
                            urgency: tender.dates?.urgency_level,
                            framework_agreement: tender.strategic?.is_framework,
                            sme_suitable: tender.strategic?.is_sme_accessible,
                            category: tender.classification?.contract_nature,
                            eforms_notice: tender.eforms_notice  // NEW: eForms structured data
                        }));
                        setTenders(tendersArray);
                        setLoading(false);
                    })
                    .catch(err => {
                        setError(err.message);
                        setLoading(false);
                    });
            }, []);

            const filteredTenders = useMemo(() => {
                return tenders.filter(tender => {
                    const matchesSearch = searchQuery === '' || 
                        tender.title?.toLowerCase().includes(searchQuery.toLowerCase()) ||
                        tender.description?.toLowerCase().includes(searchQuery.toLowerCase()) ||
                        tender.buyer_name?.toLowerCase().includes(searchQuery.toLowerCase());

                    const matchesCategory = selectedCategory === 'all' || 
                        tender.category === selectedCategory;

                    const matchesUrgency = selectedUrgency === 'all' || 
                        tender.urgency === selectedUrgency;

                    const matchesFramework = !showFrameworkOnly || 
                        tender.framework_agreement;
                    
                    const matchesMultiLot = !showMultiLotOnly || 
                        (tender.lot_count > 1);

                    return matchesSearch && matchesCategory && matchesUrgency && matchesFramework && matchesMultiLot;
                });
            }, [tenders, searchQuery, selectedCategory, selectedUrgency, showFrameworkOnly, showMultiLotOnly]);

            const stats = useMemo(() => {
                const critical = tenders.filter(t => t.urgency === 'CRITICAL').length;
                const moderate = tenders.filter(t => t.urgency === 'MODERATE').length;
                const sme = tenders.filter(t => t.sme_suitable).length;
                const framework = tenders.filter(t => t.framework_agreement).length;
                const multiLot = tenders.filter(t => t.lot_count > 1).length;

                return { critical, moderate, sme, framework, multiLot };
            }, [tenders]);

            if (loading) {
                return (
                    <div className="loading">
                        <div className="loading-spinner"></div>
                        <h2>Loading tenders...</h2>
                        <p>Please wait while we fetch the latest opportunities</p>
                    </div>
                );
            }

            if (error) {
                return (
                    <div className="error">
                        <div className="error-icon">‚ö†Ô∏è</div>
                        <h2 className="error-title">Error loading data</h2>
                        <p className="error-message">{error}</p>
                        <p className="error-message">Please ensure tenders_enhanced.json is in the same directory.</p>
                    </div>
                );
            }

            return (
                <div className="app-container">
                    <Sidebar 
                        language={language}
                        setLanguage={setLanguage}
                        searchQuery={searchQuery}
                        setSearchQuery={setSearchQuery}
                        selectedCategory={selectedCategory}
                        setSelectedCategory={setSelectedCategory}
                        selectedUrgency={selectedUrgency}
                        setSelectedUrgency={setSelectedUrgency}
                        showFrameworkOnly={showFrameworkOnly}
                        setShowFrameworkOnly={setShowFrameworkOnly}
                        showMultiLotOnly={showMultiLotOnly}
                        setShowMultiLotOnly={setShowMultiLotOnly}
                    />
                    <main className="main-content">
                        <Header totalTenders={tenders.length} filteredCount={filteredTenders.length} />
                        <StatsGrid stats={stats} />
                        <TendersList tenders={filteredTenders} language={language} />
                    </main>
                </div>
            );
        }

        function Sidebar({ 
            language, setLanguage, 
            searchQuery, setSearchQuery, 
            selectedCategory, setSelectedCategory,
            selectedUrgency, setSelectedUrgency,
            showFrameworkOnly, setShowFrameworkOnly,
            showMultiLotOnly, setShowMultiLotOnly
        }) {
            return (
                <aside className="sidebar">
                    <div className="logo">üá™üá∫ TED Pro</div>
                    <p className="tagline">Denmark Tender Intelligence Platform</p>

                    {/* Language Switcher */}
                    <div className="language-switcher">
                        <button 
                            className={`language-btn ${language === 'eng' ? 'active' : ''}`}
                            onClick={() => setLanguage('eng')}
                        >
                            üá¨üáß English
                        </button>
                        <button 
                            className={`language-btn ${language === 'dan' ? 'active' : ''}`}
                            onClick={() => setLanguage('dan')}
                        >
                            üá©üá∞ Dansk
                        </button>
                    </div>

                    <div className="profile-section">
                        <div className="profile-header">
                            <span>Profile Status</span>
                            <span className="profile-badge inactive">Demo Mode</span>
                        </div>
                        <p className="profile-text">
                            Sign in to save searches, get alerts, and track opportunities
                        </p>
                        <button className="profile-btn">Create Free Account</button>
                    </div>

                    <div className="filters-section">
                        <div className="filter-group">
                            <div className="filter-label">Search</div>
                            <input 
                                type="text" 
                                className="search-input" 
                                placeholder="Search tenders..." 
                                value={searchQuery}
                                onChange={(e) => setSearchQuery(e.target.value)}
                            />
                        </div>

                        <div className="filter-group">
                            <div className="filter-label">Urgency</div>
                            <div className="filter-chips">
                                {['all', 'CRITICAL', 'MODERATE', 'STANDARD'].map(urgency => (
                                    <button
                                        key={urgency}
                                        className={`filter-chip ${selectedUrgency === urgency ? 'active' : ''}`}
                                        onClick={() => setSelectedUrgency(urgency)}
                                    >
                                        {urgency === 'all' ? 'All' : urgency}
                                    </button>
                                ))}
                            </div>
                        </div>

                        <div className="filter-group">
                            <div className="filter-label">Options</div>
                            <div className="filter-chips">
                                <button
                                    className={`filter-chip ${showFrameworkOnly ? 'active' : ''}`}
                                    onClick={() => setShowFrameworkOnly(!showFrameworkOnly)}
                                >
                                    üìã Framework Only
                                </button>
                                <button
                                    className={`filter-chip ${showMultiLotOnly ? 'active' : ''}`}
                                    onClick={() => setShowMultiLotOnly(!showMultiLotOnly)}
                                >
                                    üì¶ Multi-Lot Only
                                </button>
                            </div>
                        </div>
                    </div>
                </aside>
            );
        }

        function Header({ totalTenders, filteredCount }) {
            return (
                <header className="header">
                    <h1 className="header-title">Denmark Active Tenders</h1>
                    <p className="header-subtitle">
                        Showing {filteredCount} of {totalTenders} opportunities
                    </p>
                </header>
            );
        }

        function StatsGrid({ stats }) {
            return (
                <div className="stats-grid">
                    <div className="stat-card">
                        <div className="stat-label">‚ö° Critical Urgency</div>
                        <div className="stat-value">{stats.critical}</div>
                    </div>
                    <div className="stat-card">
                        <div className="stat-label">‚è∞ Moderate Urgency</div>
                        <div className="stat-value">{stats.moderate}</div>
                    </div>
                    <div className="stat-card">
                        <div className="stat-label">üè¢ SME Suitable</div>
                        <div className="stat-value">{stats.sme}</div>
                    </div>
                    <div className="stat-card">
                        <div className="stat-label">üìã Framework Agreements</div>
                        <div className="stat-value">{stats.framework}</div>
                    </div>
                    <div className="stat-card">
                        <div className="stat-label">üì¶ Multi-Lot Tenders</div>
                        <div className="stat-value">{stats.multiLot}</div>
                    </div>
                </div>
            );
        }

        function TendersList({ tenders, language }) {
            if (tenders.length === 0) {
                return (
                    <div className="no-results">
                        <div className="no-results-icon">üîç</div>
                        <h2 className="no-results-title">No tenders found</h2>
                        <p className="no-results-text">Try adjusting your filters</p>
                    </div>
                );
            }

            return (
                <div className="tenders-list">
                    {tenders.map((tender, index) => (
                        <TenderCard key={index} tender={tender} language={language} />
                    ))}
                </div>
            );
        }

        function TenderCard({ tender, language }) {
            const [expanded, setExpanded] = useState(false);
            const [showLotDetails, setShowLotDetails] = useState(false);
            const [showEForms, setShowEForms] = useState(false);

            const formatDate = (dateStr) => {
                if (!dateStr) return 'Not specified';
                try {
                    return new Date(dateStr).toLocaleDateString('en-US', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric'
                    });
                } catch {
                    return dateStr;
                }
            };

            const formatValue = (value, currency) => {
                if (!value) return null;
                try {
                    const num = parseFloat(value);
                    if (isNaN(num)) return null;
                    return `${num.toLocaleString()} ${currency || 'DKK'}`;
                } catch {
                    return null;
                }
            };

            const needsReadMore = tender.description && tender.description.length > 600;
            const displayedDescription = expanded || !needsReadMore 
                ? tender.description 
                : tender.description.substring(0, 600) + '...';

            const estimatedValue = formatValue(tender.estimated_value, tender.estimated_value_currency);

            // Get lot information
            const isMultiLot = tender.lot_count > 1;
            const lotIdentifiers = tender.strategic?.lot_identifiers || [];
            const lotTitles = tender.strategic?.lot_titles || [];
            const lotDescriptions = tender.strategic?.lot_descriptions || [];
            
            // Get eForms data
            const eforms = tender.eforms_notice;
            const hasEForms = eforms && Object.keys(eforms).length > 0;
            
            // Debug logging for multi-lot tenders
            if (isMultiLot && lotIdentifiers.length > 2) {
                console.log(`Multi-lot tender: ${tender.title.substring(0, 40)}...`);
                console.log(`  Lot IDs: ${lotIdentifiers.length}`, lotIdentifiers);
                console.log(`  Lot Titles: ${lotTitles.length}`, lotTitles);
                console.log(`  Lot Descriptions: ${lotDescriptions.length}`);
                console.log(`  eForms lots: ${eforms?.object?.lots?.length || 0}`);
            }

            return (
                <div className="tender-card">
                    <div className="tender-header">
                        <div style={{ flex: 1 }}>
                            <h2 className="tender-title">
                                {tender.title}
                                {isMultiLot && (
                                    <span className="lot-badge" title={`This tender is divided into ${tender.lot_count} separate lots`}>
                                        üì¶ {tender.lot_count} Lots
                                    </span>
                                )}
                            </h2>
                            <div className="tender-meta">
                                <span className="tender-meta-item">
                                    üèõÔ∏è {tender.buyer_name || 'Unknown'}
                                </span>
                                <span className="tender-meta-item">
                                    üìç {tender.buyer_city || 'Denmark'}, {tender.buyer_country || 'DNK'}
                                </span>
                                <span className="tender-meta-item">
                                    üìÖ {formatDate(tender.publication_date)}
                                </span>
                                {tender.days_until_deadline !== null && (
                                    <span className="tender-meta-item">
                                        ‚è∞ {tender.days_until_deadline} days left
                                    </span>
                                )}
                            </div>
                        </div>
                    </div>

                    {estimatedValue && (
                        <div className="tender-value">
                            <span className="tender-value-label">Estimated Value:</span>
                            <span className="tender-value-amount">üí∞ {estimatedValue}</span>
                        </div>
                    )}

                    {/* View Toggle */}
                    {hasEForms && (
                        <div className="view-toggle">
                            <button
                                className={`view-toggle-btn ${!showEForms ? 'active' : ''}`}
                                onClick={() => setShowEForms(false)}
                            >
                                üìù Summary View
                            </button>
                            <button
                                className={`view-toggle-btn ${showEForms ? 'active' : ''}`}
                                onClick={() => setShowEForms(true)}
                            >
                                üìã Official Notice (eForms)
                            </button>
                        </div>
                    )}

                    {/* eForms Structured View */}
                    {showEForms && hasEForms ? (
                        <EFormsNoticeView eforms={eforms} tender={tender} formatDate={formatDate} formatValue={formatValue} />
                    ) : (
                        /* Original Summary View */
                        <>
                            <div className={`tender-description ${expanded ? 'expanded' : ''}`}>
                                {displayedDescription}
                            </div>

                            {needsReadMore && (
                                <div className="read-more" onClick={() => setExpanded(!expanded)}>
                                    {expanded ? '‚ñ≤ Show less' : '‚ñº Read more'}
                                </div>
                            )}

                            {/* LOT DETAILS SECTION */}
                            {isMultiLot && lotIdentifiers.length > 0 && (
                                <div className="lot-details">
                                    <div className="lot-details-header" onClick={() => setShowLotDetails(!showLotDetails)}>
                                        <span>üìã Lot Breakdown ({tender.lot_count} Lots)</span>
                                        <span className="lot-details-toggle">
                                            {showLotDetails ? '‚ñ≤ Hide' : '‚ñº View All Lots'}
                                        </span>
                                    </div>
                                    
                                    {showLotDetails && (
                                        <div className="lot-items">
                                            {lotIdentifiers.map((lotId, index) => (
                                                <div key={lotId} className="lot-item">
                                                    <div className="lot-item-header">
                                                        <span className="lot-item-id">{lotId}</span>
                                                        <span className="lot-item-title">
                                                            {lotTitles[index] || `Lot ${index + 1}`}
                                                        </span>
                                                    </div>
                                                    {lotDescriptions[index] && (
                                                        <div className="lot-item-description">
                                                            {lotDescriptions[index].substring(0, 200)}
                                                            {lotDescriptions[index].length > 200 ? '...' : ''}
                                                        </div>
                                                    )}
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            )}
                        </>
                    )}

                    {tender.urls?.ted_notice_url && (
                        <p className="read-more-tip">
                            üí° For complete tender details, specifications, and documents, click 'View on TED' below
                        </p>
                    )}

                    <div className="tender-tags">
                        {tender.urgency && (
                            <span className="tender-tag urgency">
                                {tender.urgency === 'CRITICAL' ? '‚ö°' : '‚è∞'} {tender.urgency}
                            </span>
                        )}
                        {tender.framework_agreement && (
                            <span className="tender-tag framework">üìã Framework</span>
                        )}
                        {tender.sme_suitable && (
                            <span className="tender-tag sme">üè¢ SME Friendly</span>
                        )}
                        {isMultiLot && (
                            <span className="tender-tag multi-lot">
                                üì¶ Multi-Lot ({tender.lot_count})
                            </span>
                        )}
                    </div>

                    <div className="tender-actions">
                        {tender.urls?.ted_notice_url && (
                            <a 
                                href={tender.urls.ted_notice_url} 
                                target="_blank" 
                                rel="noopener noreferrer"
                                className="tender-btn primary"
                            >
                                üîó View on TED
                            </a>
                        )}
                        {tender.urls?.submission_url && (
                            <a 
                                href={tender.urls.submission_url} 
                                target="_blank" 
                                rel="noopener noreferrer"
                                className="tender-btn secondary"
                            >
                                üì§ Submit Tender
                            </a>
                        )}
                    </div>
                </div>
            );
        }

        // EForms Notice View Component - Based on eForms SDK Standard
        function EFormsNoticeView({ eforms, tender, formatDate, formatValue }) {
            try {
                if (!eforms) {
                    console.log('EFormsNoticeView: No eforms data');
                    return <div className="eforms-notice">No eForms data available</div>;
                }

                // Debug logging
                const lots = eforms?.object?.lots || [];
                console.log('EFormsNoticeView rendering:', {
                    hasEforms: !!eforms,
                    hasObject: !!eforms.object,
                    lotsCount: lots.length,
                    lots: lots.map(l => ({ id: l?.lot_identifier, title: l?.title }))
                });

                const Field = ({ label, value }) => {
                    if (!value) return null;
                    return (
                        <div className="eforms-field">
                            <div className="eforms-field-label">{label}:</div>
                            <div className="eforms-field-value">{value}</div>
                        </div>
                    );
                };

                const BooleanField = ({ label, value }) => {
                    if (value === null || value === undefined) return null;
                    return (
                        <div className="eforms-field">
                            <div className="eforms-field-label">{label}:</div>
                            <div className="eforms-field-value">{value ? 'Yes' : 'No'}</div>
                        </div>
                    );
                };

            return (
                <div className="eforms-notice">
                    {/* Header */}
                    <div className="eforms-header">
                        <div className="eforms-pub-number">
                            {eforms.notice_information?.publication_number || 'N/A'} - Competition
                        </div>
                        <div className="eforms-metadata">
                            {eforms.buyer?.identification?.postal_address?.country || 'N/A'} ‚Äì {tender.category || 'Services'} ‚Äì {tender.title}
                        </div>
                        <div className="eforms-dates">
                            Publication: {formatDate(eforms.notice_information?.publication_date)}
                        </div>
                    </div>

                    {/* COMPONENT 1: NOTICE INFORMATION */}
                    <section className="eforms-section">
                        <h3 className="eforms-section-title">
                            <span className="section-number">1.</span> Notice Information
                        </h3>
                        <div className="eforms-subsection">
                            <Field label="Notice Type" value={eforms.notice_information?.notice_type} />
                            <Field label="Procedure Type" value={eforms.notice_information?.procedure_type} />
                            <Field label="Procedure Identifier" value={eforms.notice_information?.procedure_identifier} />
                            <Field label="Legal Basis" value={eforms.notice_information?.legal_basis} />
                        </div>
                    </section>

                    {/* COMPONENT 2: BUYER */}
                    <section className="eforms-section">
                        <h3 className="eforms-section-title">
                            <span className="section-number">2.</span> Buyer
                        </h3>
                        <div className="eforms-subsection">
                            <h4>2.1. Buyer</h4>
                            <Field label="Official name" value={eforms.buyer?.identification?.official_name} />
                            {eforms.buyer?.identification?.contact_details?.email && (
                                <div className="eforms-field">
                                    <div className="eforms-field-label">Email:</div>
                                    <div className="eforms-field-value">
                                        <a href={`mailto:${eforms.buyer.identification.contact_details.email}`}>
                                            {eforms.buyer.identification.contact_details.email}
                                        </a>
                                    </div>
                                </div>
                            )}
                            <Field label="Internet address" value={eforms.buyer?.identification?.contact_details?.internet_address} />
                            <Field label="Legal type of the buyer" value={eforms.buyer?.ca_ce_type} />
                            <Field label="Main activity" value={eforms.buyer?.main_activity} />
                        </div>
                    </section>

                    {/* COMPONENT 3: OBJECT */}
                    <section className="eforms-section">
                        <h3 className="eforms-section-title">
                            <span className="section-number">3.</span> Object
                        </h3>
                        <div className="eforms-subsection">
                            <h4>3.1. Procurement Scope</h4>
                            <Field label="Title" value={eforms.object?.procurement_scope?.title} />
                            <Field label="Short description" value={eforms.object?.procurement_scope?.short_description} />
                            <Field label="Main CPV" value={eforms.object?.procurement_scope?.main_cpv} />
                            <Field label="Contract nature" value={eforms.object?.procurement_scope?.contract_nature} />
                            {eforms.object?.procurement_scope?.estimated_value && (
                                <Field label="Estimated value" 
                                       value={formatValue(eforms.object.procurement_scope.estimated_value, eforms.object.procurement_scope.currency)} />
                            )}
                            {eforms.object?.procurement_scope?.lots_info?.has_lots && (
                                <Field label="Number of lots" value={eforms.object.procurement_scope.lots_info.number_of_lots} />
                            )}
                        </div>

                        {/* 3.2 Lots */}
                        {eforms.object?.lots && Array.isArray(eforms.object.lots) && eforms.object.lots.length > 0 && (
                            <div className="eforms-subsection">
                                <h4>3.2. Lot/Part Description</h4>
                                {eforms.object.lots.map((lot, idx) => {
                                    // Format duration object to string
                                    const formatDuration = (duration) => {
                                        if (!duration) return null;
                                        if (typeof duration === 'string') return duration;
                                        if (typeof duration === 'object' && duration.value && duration.unit) {
                                            return `${duration.value} ${duration.unit.toLowerCase()}`;
                                        }
                                        return null;
                                    };
                                    
                                    return (
                                        <div key={lot.lot_identifier || idx} className="eforms-lot">
                                            <h5>{lot.lot_identifier || `Lot ${idx + 1}`}: {lot.title || 'Untitled'}</h5>
                                            {lot.description && <Field label="Description" value={lot.description} />}
                                            {lot.main_cpv && <Field label="Main CPV" value={lot.main_cpv} />}
                                            {(lot.place_of_performance?.city || lot.place_of_performance?.country) && (
                                                <Field label="Place of performance" 
                                                       value={[lot.place_of_performance?.city, lot.place_of_performance?.country].filter(Boolean).join(', ')} />
                                            )}
                                            {lot.estimated_value && (
                                                <Field label="Estimated value" value={formatValue(lot.estimated_value, eforms.object?.procurement_scope?.currency)} />
                                            )}
                                            {lot.deadline_receipt_tenders && (
                                                <Field label="Deadline for receipt of tenders" value={formatDate(lot.deadline_receipt_tenders)} />
                                            )}
                                            {lot.duration && <Field label="Duration" value={formatDuration(lot.duration)} />}
                                        </div>
                                    );
                                })}
                            </div>
                        )}
                    </section>

                    {/* COMPONENT 4: SELECTION CRITERIA */}
                    <section className="eforms-section">
                        <h3 className="eforms-section-title">
                            <span className="section-number">4.</span> Selection Criteria
                        </h3>
                        <div className="eforms-subsection">
                            <h4>4.1. Conditions for Participation</h4>
                            <BooleanField label="Reserved procurement" value={eforms.selection_criteria?.conditions_for_participation?.reserved_procurement} />
                            <BooleanField label="Security clearance required" value={eforms.selection_criteria?.conditions_for_participation?.security_clearance_required} />
                        </div>
                        {eforms.selection_criteria?.contract_conditions?.contract_performance && (
                            <div className="eforms-subsection">
                                <h4>4.2. Contract Conditions</h4>
                                <Field label="Contract performance conditions" value={eforms.selection_criteria.contract_conditions.contract_performance} />
                            </div>
                        )}
                    </section>

                    {/* COMPONENT 5: PROCEDURE */}
                    <section className="eforms-section">
                        <h3 className="eforms-section-title">
                            <span className="section-number">5.</span> Procedure
                        </h3>
                        <div className="eforms-subsection">
                            <h4>5.1. Description</h4>
                            <Field label="Procedure type" value={eforms.procedure?.description?.procedure_type} />
                            <Field label="Main features of the procedure" value={eforms.procedure?.description?.main_features} />
                            <BooleanField label="Framework agreement" value={eforms.procedure?.description?.framework_agreement} />
                            <BooleanField label="Dynamic Purchasing System" value={eforms.procedure?.description?.dps_usage} />
                            <BooleanField label="Electronic auction" value={eforms.procedure?.description?.electronic_auction} />
                            <BooleanField label="GPA covered" value={eforms.procedure?.description?.gpa_covered} />
                        </div>
                        <div className="eforms-subsection">
                            <h4>5.2. Administrative Information</h4>
                            <Field label="Deadline for receipt of tenders" value={formatDate(eforms.procedure?.administrative_information?.deadline_receipt_tenders)} />
                            <Field label="Deadline for receipt of requests to participate" value={formatDate(eforms.procedure?.administrative_information?.deadline_receipt_requests)} />
                            <Field label="Languages in which tenders can be submitted" value={eforms.procedure?.administrative_information?.submission_language} />
                            <BooleanField label="Electronic submission required" value={eforms.procedure?.administrative_information?.electronic_submission} />
                        </div>
                    </section>

                    {/* COMPONENT 6: FURTHER INFORMATION */}
                    <section className="eforms-section">
                        <h3 className="eforms-section-title">
                            <span className="section-number">6.</span> Further Information
                        </h3>
                        <div className="eforms-subsection">
                            <BooleanField label="Recurring procurement" value={eforms.further_information?.recurring_procurement} />
                            <Field label="Additional information (Procedure)" value={eforms.further_information?.additional_information?.additional_info_proc} />
                            <Field label="Additional information (Lot)" value={eforms.further_information?.additional_information?.additional_info_lot} />
                        </div>
                    </section>
                </div>
            );
            } catch (error) {
                console.error('EFormsNoticeView error:', error);
                return (
                    <div className="eforms-notice">
                        <div style={{ padding: '2rem', background: '#fff3cd', borderRadius: '8px' }}>
                            <h3 style={{ color: '#856404', marginBottom: '1rem' }}>‚ö†Ô∏è Unable to display eForms view</h3>
                            <p style={{ color: '#856404' }}>Error: {error.message}</p>
                            <p style={{ marginTop: '1rem', color: '#666' }}>Please check the browser console for details or try the Summary View.</p>
                        </div>
                    </div>
                );
            }
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>

